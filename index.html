<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1220" />
  <title>랜덤 지하철 · 역 · 음식 (슬롯)</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:rgba(255,255,255,.06);
      --border:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --shadow: 0 18px 55px rgba(0,0,0,.48);
      --radius: 18px;
      --radius2: 22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 15% -10%, rgba(56,189,248,.22), transparent 55%),
        radial-gradient(1100px 700px at 105% 0%, rgba(34,197,94,.22), transparent 50%),
        radial-gradient(800px 600px at 50% 125%, rgba(148,163,184,.10), transparent 55%),
        linear-gradient(180deg, #070b14 0%, #0b1220 50%, #070b14 100%);
      overflow-x:hidden;
    }
    .wrap{max-width:920px; margin:0 auto; padding:18px 14px 54px;}
    header{display:flex; align-items:flex-start; justify-content:space-between; gap:12px; padding:8px 6px 16px;}
    .brand{display:flex; flex-direction:column; gap:6px;}
    h1{margin:0; font-size:18px; letter-spacing:-.3px;}
    .sub{margin:0; color:var(--muted); font-size:12.5px; line-height:1.35;}

    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border:1px solid var(--border);
      border-radius:999px;
      background:rgba(255,255,255,.04);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      color:var(--muted);
      font-size:12px;
      user-select:none;
      white-space:nowrap;
    }
    .dot{width:8px;height:8px;border-radius:999px;background:rgba(148,163,184,.5)}

    .grid{display:grid; gap:12px;}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border: 1px solid var(--border);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      padding: 14px;
      position:relative;
      overflow:hidden;
    }
    .card:before{
      content:"";
      position:absolute;
      inset:-80px;
      background: radial-gradient(420px 240px at var(--mx, 30%) var(--my, 0%), rgba(56,189,248,.12), transparent 60%);
      pointer-events:none;
      opacity:.95;
    }

    .steps{display:grid; gap:12px;}
    .step{
      display:grid; gap:10px;
      background:rgba(0,0,0,.18);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:12px;
      position:relative;
      overflow:hidden;
    }
    .stepHead{display:flex; align-items:center; justify-content:space-between; gap:10px;}
    .kicker{display:flex; align-items:center; gap:10px;}
    .badge{
      width:26px;height:26px;border-radius:10px;
      display:grid; place-items:center;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:rgba(229,231,235,.9);
      font-weight:900;
      font-size:13px;
    }
    .label{display:flex; flex-direction:column; gap:2px;}
    .label b{font-size:14px; letter-spacing:-.2px;}
    .label span{font-size:12px; color:var(--muted)}

    .value{
      font-size:20px;
      font-weight:950;
      letter-spacing:-.5px;
      line-height:1.15;
      min-height: 28px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .value .mini{
      font-size:12px;
      font-weight:850;
      color:rgba(229,231,235,.75);
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      white-space:nowrap;
    }

    .btnRow{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
    button{
      appearance:none;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:12px 12px;
      border-radius:16px;
      font-weight:900;
      cursor:pointer;
      transition: transform .06s ease, background .12s ease, border-color .12s ease, opacity .12s ease;
      touch-action:manipulation;
    }
    button:active{transform:scale(.99)}
    button:focus{outline:none; box-shadow:0 0 0 3px rgba(56,189,248,.25)}
    .primary{
      background: linear-gradient(135deg, rgba(34,197,94,.92), rgba(56,189,248,.85));
      border-color: rgba(255,255,255,.14);
      color:#06111a;
    }
    .secondary{background: linear-gradient(135deg, rgba(255,255,255,.07), rgba(255,255,255,.03));}
    .ghost{background:transparent}
    .danger{border-color: rgba(251,113,133,.45)}
    button[disabled]{opacity:.45; cursor:not-allowed; transform:none}

    .footerRow{display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between; margin-top:12px;}
    .hint{color:var(--muted); font-size:12px; line-height:1.35}
    .hint code{color:rgba(229,231,235,.85)}
    .metaPills{display:flex; flex-wrap:wrap; gap:8px;}

    .toast{
      position:fixed;
      left:50%;
      bottom:16px;
      transform:translateX(-50%);
      background:rgba(0,0,0,.6);
      border:1px solid rgba(148,163,184,.25);
      color:rgba(229,231,235,.92);
      padding:10px 12px;
      border-radius:999px;
      font-size:12.5px;
      box-shadow: 0 20px 55px rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index:9999;
      max-width: calc(100% - 28px);
      text-overflow: ellipsis;
      overflow:hidden;
      white-space:nowrap;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-2px)}

    .locked:after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,.08), rgba(0,0,0,.18));
      pointer-events:none;
    }

    .lineSwatch{
      width:10px; height:10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.35);
      box-shadow:0 0 0 3px rgba(0,0,0,.22);
    }

    @keyframes popIn{
      0%{transform:translateY(6px) scale(.99); opacity:0}
      100%{transform:translateY(0) scale(1); opacity:1}
    }
    @keyframes finalPop{
      0%{transform:scale(1)}
      40%{transform:scale(1.03)}
      100%{transform:scale(1)}
    }
    .animate{animation: popIn .12s ease}
    .final{animation: finalPop .22s ease}

    @media (min-width: 720px){
      h1{font-size:20px}
      .steps{grid-template-columns:1fr 1fr 1fr;}
      .btnRow{grid-template-columns: 1fr;}
      .value{min-height: 52px; align-items:flex-start}

    @keyframes punch {
      0% { transform: scale(1); }
      35% { transform: scale(1.08); }
      100% { transform: scale(1); }
    }
    .punch {
      animation: punch .22s ease;
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-3px); }
      50% { transform: translateX(3px); }
      75% { transform: translateX(-2px); }
      100% { transform: translateX(0); }
    }
    .shake {
      animation: shake .18s ease;
    }

    }

    .modal{position:fixed; inset:0; display:none; z-index:10000;}
    .modal.show{display:block;}
    .modalBackdrop{
      position:absolute; inset:0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
    }
    .modalSheet{
      position:absolute;
      left:50%;
      bottom:0;
      transform: translateX(-50%);
      width: min(880px, calc(100% - 18px));
      max-height: 78vh;
      overflow:auto;
      border:1px solid rgba(148,163,184,.22);
      border-radius: 22px 22px 0 0;
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      box-shadow: 0 25px 80px rgba(0,0,0,.6);
      padding: 12px;
    }
    .modalHead{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
      padding: 6px 4px 10px;
      border-bottom:1px solid rgba(148,163,184,.14);
    }
    .modalHead b{font-size:14px; letter-spacing:-.2px;}
    .modalSub{font-size:12px; color: var(--muted); margin-top:3px;}
    .modalActions{display:flex; gap:8px; flex-wrap:wrap; padding:10px 2px 6px;}
    .modalGroup{padding-top:10px; border-top:1px solid rgba(148,163,184,.12); margin-top:8px;}
    .modalGroupHead{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px;}
    .modalGroupHead b{font-size:13px;}
    .modalFooter{
      position: sticky;
      bottom: 0;
      padding: 10px 0 2px;
      background: linear-gradient(180deg, rgba(11,18,32,0), rgba(11,18,32,.55) 40%, rgba(11,18,32,.92));
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top: 10px;
    }
    .lpGrid{display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:8px;}
    @media(min-width:720px){ .lpGrid{grid-template-columns: repeat(3, minmax(0,1fr));} }

    .chk{
      display:flex; align-items:center; gap:8px;
      padding:10px 10px;
      border:1px solid rgba(148,163,184,.18);
      border-radius: 14px;
      background: rgba(0,0,0,.16);
      cursor:pointer;
      user-select:none;
    }
    .chk input{accent-color: rgba(56,189,248,.95);}
    .chk small{color:rgba(229,231,235,.88); font-weight:900; letter-spacing:-.2px;}
    .chk .sw{width:10px;height:10px;border-radius:999px;border:1px solid rgba(255,255,255,.35);}

  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1>랜덤 지하철 · 역 · 음식 (슬롯)</h1>
        <p class="sub"></p>
      </div>
      <div class="chip" id="statusChip" title="현재 상태">
        <span class="dot" id="statusDot"></span>
        <span id="statusText">대기 중</span>
      </div>
    </header>

    <main class="grid">
      <section class="card" id="card">
        <div class="steps">

          <!-- Step 1 -->
          <div class="step" id="step1">
            <div class="stepHead">
              <div class="kicker">
                <div class="badge">1</div>
                <div class="label">
                  <b>수도권 노선</b>
                  <span>시작 → 멈춤</span>
                </div>

              </div>
              <button class="secondary" type="button" id="openLineModal">노선 선택하기</button>
            </div>

            <div class="value" id="lineValue">
              <span class="mini">시작을 눌러줘</span>
            </div>

            <div class="btnRow">
              <button class="primary" id="lineStart">시작</button>
              <button class="secondary" id="lineStop" disabled>멈춤</button>
            </div>



          </div>

          <!-- Step 2 -->
          <div class="step locked" id="step2">
            <div class="stepHead">
              <div class="kicker">
                <div class="badge">2</div>
                <div class="label">
                  <b>해당 노선의 역</b>
                  <span>노선 확정 후 가능</span>
                </div>
              </div>
            </div>

            <div class="value" id="stationValue">
              <span class="mini">노선을 먼저 확정해줘</span>
            </div>

            <div class="btnRow">
              <button class="primary" id="stationStart" disabled>시작</button>
              <button class="secondary" id="stationStop" disabled>멈춤</button>
            </div>
          </div>

          <!-- Step 3 -->
          <div class="step locked" id="step3">
            <div class="stepHead">
              <div class="kicker">
                <div class="badge">3</div>
                <div class="label">
                  <b>음식 종류</b>
                  <span>역 확정 후 가능</span>
                </div>
              </div>
            </div>

            <div class="value" id="foodValue">
              <span class="mini">역을 먼저 확정해줘</span>
            </div>

            <div class="btnRow">
              <button class="primary" id="foodStart" disabled>시작</button>
              <button class="secondary" id="foodStop" disabled>멈춤</button>
            </div>
          </div>
        </div>

        <div class="footerRow">
          <div class="hint">
            • 노선은 후보군을 지정할 수 있습니다.
          </div>
          <div class="metaPills">
            <button class="ghost danger" id="resetAll">전체 초기화</button>
            <button class="ghost" id="copyResult">결과 복사</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div class="toast" id="toast">복사됨</div>
<div class="modal" id="lineModal" aria-hidden="true">
  <div class="modalBackdrop" id="lineModalBackdrop"></div>

  <div class="modalSheet" role="dialog" aria-modal="true" aria-label="노선 선택">
    <div class="modalHead">
      <div>
        <b>노선 선택</b>
        <div class="modalSub" id="lineCountText">0개 선택됨</div>
      </div>
      <button class="ghost danger" type="button" id="closeLineModal">닫기</button>
    </div>

    <div class="modalActions">
      <button class="ghost" type="button" id="allOn">전체 선택</button>
      <button class="ghost danger" type="button" id="allOff">전체 해제</button>
    </div>

    <div class="modalGroup">
      <div class="modalGroupHead">
        <b>도시철도</b>
        <div class="modalActions">
          <button class="ghost" type="button" data-group-on="metro">전체 선택</button>
          <button class="ghost danger" type="button" data-group-off="metro">전체 해제</button>
        </div>
      </div>
      <div class="lpGrid" id="group-metro"></div>
    </div>

    <div class="modalGroup">
      <div class="modalGroupHead">
        <b>광역/코레일</b>
        <div class="modalActions">
          <button class="ghost" type="button" data-group-on="rail">전체 선택</button>
          <button class="ghost danger" type="button" data-group-off="rail">전체 해제</button>
        </div>
      </div>
      <div class="lpGrid" id="group-rail"></div>
    </div>

    <div class="modalGroup">
      <div class="modalGroupHead">
        <b>경전철</b>
        <div class="modalActions">
          <button class="ghost" type="button" data-group-on="lrt">전체 선택</button>
          <button class="ghost danger" type="button" data-group-off="lrt">전체 해제</button>
        </div>
      </div>
      <div class="lpGrid" id="group-lrt"></div>
    </div>

    <div class="modalFooter">
      <button class="secondary" type="button" id="cancelLineModal">취소</button>
      <button class="primary" type="button" id="applyLineModal">확인</button>
    </div>
  </div>
</div>

  <script>
    const DATA = {
    lines: [
      // ✅ 도시철도(metro): 서울 1~9, 인천 1/2
      { id:"line1", name:"1호선", color:"#0b5bd3", group:"metro" },
      { id:"line2", name:"2호선", color:"#22c55e", group:"metro" },
      { id:"line3", name:"3호선", color:"#f97316", group:"metro" },
      { id:"line4", name:"4호선", color:"#38bdf8", group:"metro" },
      { id:"line5", name:"5호선", color:"#a855f7", group:"metro" },
      { id:"line6", name:"6호선", color:"#d97706", group:"metro" },
      { id:"line7", name:"7호선", color:"#84cc16", group:"metro" },
      { id:"line8", name:"8호선", color:"#ec4899", group:"metro" },
      { id:"line9", name:"9호선", color:"#eab308", group:"metro" },
      { id:"incheon1", name:"인천1호선", color:"#0047ab", group:"metro" },
      { id:"incheon2", name:"인천2호선", color:"#00a651", group:"metro" },

      // ✅ 광역/코레일(rail)
      { id:"airport", name:"공항철도", color:"#06b6d4", group:"rail" },
      { id:"sinbundang", name:"신분당선", color:"#ef4444", group:"rail" },
      { id:"suinbundang", name:"수인·분당선", color:"#f59e0b", group:"rail" },
      { id:"gyeongui_jungang", name:"경의·중앙선", color:"#60a5fa", group:"rail" },
      { id:"gyeongchun", name:"경춘선", color:"#34d399", group:"rail" },
      { id:"seohae", name:"서해선", color:"#8b5cf6", group:"rail" },
      { id:"gyeonggang", name:"경강선", color:"#ff6f00", group:"rail" },

      // ✅ 경전철(lrt)
      { id:"ui_lrt", name:"우이신설선 (LRT)", color:"#a3a3a3", group:"lrt" },
      { id:"shinlim", name:"신림선 (경전철)", color:"#6789ca", group:"lrt" },
      { id:"everline", name:"에버라인 (용인 경전철)", color:"#f16521", group:"lrt" },
      { id:"u_line", name:"U Line (의정부 경전철)", color:"#009fe3", group:"lrt" },
      { id:"gimpo_gold", name:"김포 골드라인", color:"#ffdd00", group:"lrt" }
    ],
      stations: {
    "line1": [
      "연천", "전곡", "청산", "소요산", "동두천", "보산", "동두천중앙", "지행", "덕정", "덕계", "양주", "녹양", "가능", "의정부", "회룡", "망월사", "도봉산", "도봉", "방학", "창동", "녹천", "월계", "광운대", "석계", "신이문", "외대앞", "회기", "청량리", "제기동", "신설동", "동묘앞", "동대문", "종로5가", "종로3가", "종각", "시청", "서울역", "남영", "용산", "노량진", "대방", "신길", "영등포", "신도림", "구로", "구일", "개봉", "오류동", "온수", "역곡", "소사", "부천", "중동", "송내", "부개", "부평", "백운", "동암", "간석", "주안", "도화", "제물포", "도원", "동인천", "인천", "가산디지털단지", "독산", "금천구청", "석수", "관악", "안양", "명학", "금정", "군포", "당정", "의왕", "성균관대", "화서", "수원", "세류", "병점", "세마", "오산대", "오산", "진위", "송탄", "서정리", "평택지제", "평택", "성환", "직산", "두정", "천안", "봉명", "쌍용", "아산", "탕정", "배방", "풍기", "온양온천", "신창"
    ],
    "line2": [
      "시청", "을지로입구", "을지로3가", "을지로4가", "동대문역사문화공원", "신당", "상왕십리", "왕십리", "한양대", "뚝섬", "성수", "건대입구", "구의", "강변", "잠실나루", "잠실", "잠실새내", "종합운동장", "삼성", "선릉", "역삼", "강남", "교대", "서초", "방배", "사당", "낙성대", "서울대입구", "봉천", "신림", "신대방", "구로디지털단지", "대림", "신도림", "문래", "영등포구청", "당산", "합정", "홍대입구", "신촌", "이대", "아현", "충정로"
    ],
    "line3": [
      "대화", "주엽", "정발산", "마두", "백석", "대곡", "화정", "원당", "원흥", "삼송", "지축", "구파발", "연신내", "불광", "녹번", "홍제", "무악재", "독립문", "경복궁", "안국", "종로3가", "을지로3가", "충무로", "동대입구", "약수", "금호", "옥수", "압구정", "신사", "잠원", "고속터미널", "교대", "남부터미널", "양재", "매봉", "도곡", "대치", "학여울", "대청", "일원", "수서", "가락시장", "경찰병원", "오금"
    ],
    "line4": [
      "진접", "오남", "풍양", "별내별가람", "불암산", "상계", "노원", "창동", "쌍문", "수유", "미아", "미아사거리", "길음", "성신여대입구", "한성대입구", "혜화", "동대문", "동대문역사문화공원", "충무로", "명동", "회현", "서울역", "숙대입구", "삼각지", "신용산", "이촌", "동작", "총신대입구", "사당", "남태령", "선바위", "경마공원", "대공원", "과천", "정부과천청사", "인덕원", "평촌", "범계", "금정", "산본", "수리산", "대야미", "반월", "상록수", "한대앞", "중앙", "고잔", "초지", "안산", "신길온천", "정왕", "오이도"
    ],
    "line5": [
      "방화", "개화산", "김포공항", "송정", "마곡", "발산", "우장산", "화곡", "까치산", "신정", "목동", "오목교", "양평", "영등포구청", "영등포시장", "신길", "여의도", "여의나루", "마포", "공덕", "애오개", "충정로", "서대문", "광화문", "종로3가", "을지로4가", "동대문역사문화공원", "청구", "신금호", "행당", "왕십리", "마장", "답십리", "장한평", "군자", "아차산", "광나루", "천호", "강동", "길동", "굽은다리", "명일", "고덕", "상일동", "강일", "미사", "하남풍산", "하남시청", "하남검단산"
    ],
    "line6": [
      "응암", "역촌", "불광", "독바위", "연신내", "구산", "새절", "증산", "디지털미디어시티", "월드컵경기장", "마포구청", "망원", "합정", "상수", "광흥창", "대흥", "공덕", "효창공원앞", "삼각지", "녹사평", "이태원", "한강진", "버티고개", "약수", "청구", "신당", "동묘앞", "창신", "보문", "안암", "고려대", "월곡", "상월곡", "돌곶이", "석계", "태릉입구", "화랑대", "봉화산", "신내"
    ],
    "line7": [
      "포천", "대진대", "소흘", "옥정중앙", "고읍", "탑석", "장암", "도봉산", "수락산", "마들", "노원", "중계", "하계", "공릉", "태릉입구", "먹골", "중화", "상봉", "면목", "사가정", "용마산", "중곡", "군자", "어린이대공원", "건대입구", "자양", "청담", "강남구청", "학동", "논현", "반포", "고속터미널", "내방", "이수", "남성", "숭실대입구", "상도", "장승배기", "신대방삼거리", "보라매", "신풍", "대림", "남구로", "가산디지털단지", "철산", "광명사거리", "천왕", "온수", "까치울", "부천종합운동장", "춘의", "신중동", "부천시청", "상동", "삼산체육관", "굴포천", "부평구청", "산곡", "석남", "독골사거리", "가현", "심곡천", "커낼웨이", "청라시티타워", "청라국제업무단지", "청라국제도시"
    ],
    "line8": [
      "별내별가람", "별내", "다산", "동구릉", "구리", "장자호수공원", "암사역사공원", "암사", "천호", "강동구청", "몽촌토성", "잠실", "석촌", "송파", "가락시장", "문정", "장지", "복정", "남위례", "산성", "남한산성입구", "단대오거리", "신흥", "수진", "모란"
    ],
    "line9": [
      "개화", "김포공항", "공항시장", "신방화", "마곡나루", "양천향교", "가양", "증미", "등촌", "염창", "신목동", "선유도", "당산", "국회의사당", "여의도", "샛강", "노량진", "노들", "흑석", "동작", "구반포", "신반포", "고속터미널", "사평", "신논현", "언주", "선정릉", "삼성중앙", "봉은사", "종합운동장", "삼전", "석촌고분", "석촌", "송파나루", "한성백제", "올림픽공원", "둔촌오륜", "중앙보훈병원", "길동생태공원", "신명일", "고덕", "샘터공원"
    ],
    "airport": [
      "서울역", "공덕", "홍대입구", "디지털미디어시티", "마곡나루", "김포공항", "계양", "검암", "청라국제도시", "영종", "운서", "공항화물청사", "인천공항1터미널", "인천공항2터미널"
    ],
    "sinbundang": [
      "신사", "논현", "신논현", "강남", "양재", "양재시민의숲", "청계산입구", "판교", "정자", "미금", "동천", "수지구청", "성북", "상현", "광교중앙", "광교"
    ],
    "suinbundang": [
      "청량리", "왕십리", "서울숲", "압구정로데오", "강남구청", "선정릉", "선릉", "한티", "도곡", "구룡", "개포동", "대모산입구", "수서", "복정", "가천대", "태평", "모란", "야탑", "이매", "서현", "수내", "정자", "미금", "오리", "죽전", "보정", "구성", "신갈", "기흥", "상갈", "청명", "영통", "망포", "매탄권선", "수원시청", "매교", "수원", "고색", "오목천", "어천", "야목", "사리", "한대앞", "중앙", "고잔", "초지", "안산", "신길온천", "정왕", "오이도", "달월", "월곶", "소래포구", "인천논현", "호구포", "남동인더스파크", "원인재", "연수", "송도", "학익", "인하대", "숭의", "신포", "인천"
    ],
    "gyeongui_jungang": [
      "문산", "파주", "월롱", "금촌", "금릉", "운정", "야당", "탄현", "일산", "풍산", "백마", "곡산", "대곡", "능곡", "행신", "강매", "화전", "수색", "디지털미디어시티", "가좌", "신촌", "서울", "용산", "이촌", "서빙고", "한남", "옥수", "응봉", "왕십리", "청량리", "회기", "중랑", "망우", "양원", "구리", "도농", "양정", "덕소", "도심", "팔당", "운길산", "양수", "신원", "국수", "아신", "오빈", "양평", "원덕", "용문", "지평"
    ],
    "gyeongchun": [
      "청량리", "회기", "중랑", "망우", "신내", "갈매", "별내", "퇴계원", "사릉", "금곡", "평내호평", "천마산", "마석", "대성리", "청평", "상천", "가평", "굴봉산", "백양리", "강촌", "김유정", "남춘천", "춘천"
    ],
    "seohae": [
      "대곡", "능곡", "김포공항", "원종", "부천종합운동장", "소사", "소새울", "시흥대야", "신천", "신현", "시흥시청", "시흥능공", "달미", "선부", "초지", "시우", "원시"
    ],
    "ui_lrt": [
      "북한산우이", "솔밭공원", "4·19민주묘지", "가오리", "화계", "삼양", "삼양사거리", "솔샘", "정릉", "성신여대입구", "보문", "신설동"
    ],
    "shinlim": [
      "샛강", "대방", "서울지방병무청", "보라매", "보라매공원", "보라매병원", "당곡", "신림", "서원", "서울대벤처타운", "관악산"
    ],
    "incheon1": [
      "검단호수공원", "신검단중앙", "아라", "계양", "귤현", "박촌", "임학", "계산", "경인교대입구", "작전", "갈산", "부평구청", "부평시장", "부평", "동수", "부평삼거리", "간석오거리", "인천시청역", "예술회관", "인천터미널", "문학경기장", "선학", "신연수", "원인재", "동춘", "동막", "캠퍼스타운", "테크노파크", "지식정보단지", "인천대입구", "센트럴파크", "국제업무지구", "송도달빛축제공원"
    ],
    "incheon2": [
      "검단오류", "왕길", "검단사거리", "마전", "완정", "독정", "검암", "검바위", "아시아드경기장", "서구청", "가정", "가정중앙시장", "석남", "서부여성회관", "인천가좌", "가재울", "주안국가산단", "주안", "시민공원", "석바위시장", "인천시청", "석천사거리", "모래내시장", "만수", "남동구청", "인천대공원", "운연"
    ],
    "everline": [
      "기흥", "강남대", "지석", "어정", "동백", "초당", "삼가", "시청·용인대", "명지대", "김량장", "용인중앙시장", "고진", "보평", "둔전", "전대·에버랜드"
    ],
    "u_line": [
      "발곡", "회룡", "범골", "의정부경전철", "의정부시청", "흥선", "의정부중앙", "동오", "새말", "효자", "곤제", "어룡", "송산", "탑석", "차량기지임시승강장"
    ],
    "gyeonggang": [
      "판교", "성남", "이매", "삼동", "경기광주", "초월", "곤지암", "신둔도예촌", "이천", "부발", "세종대왕릉", "여주"
    ],
    "gimpo_gold": [
      "양촌", "구래", "마산", "장기", "운양", "걸포북변", "사우", "풍무", "고촌", "김포공항"
    ]
  },
      foods: [
 "국밥","돈까스","초밥","라멘","파스타","피자","쌀국수","마라탕",
 "삼겹살","곱창","족발/보쌈","카페/디저트","베이커리","브런치","치킨","햄버거",
 "떡볶이","냉면","샤브샤브","이자카야",
 "분식","튀김","타코/멕시칸","스테이크","샤오롱바오","비빔밥","우동","카레",
 "돈부리","볶음밥","돼지국밥","오코노미야키","타이 음식","베트남 쌀국수","중화요리",
 "전통 찻집","와인바","칵테일바","맥주집","핫도그","핫플 레스토랑"
]
    };

    // ----- Effects ----
    function celebrate(el){
      if(!el) return;
      el.classList.remove('punch');
      void el.offsetWidth;
      el.classList.add('punch');
      if (navigator.vibrate) navigator.vibrate(25);
    }

    // ----- Modal ----
    const lineSelect = { map: new Map() }; // 적용된 값
    const lineTemp   = { map: new Map() }; // 모달에서 편집

    function initLineSelect(){
      DATA.lines.forEach(l => lineSelect.map.set(l.id, true)); // 기본 전부 선택
    }

    initLineSelect();

    function copySelectToTemp(){
      lineTemp.map = new Map(lineSelect.map);
    }

    function applyTempToSelect(){
      lineSelect.map = new Map(lineTemp.map);
    }

    function getSelectedLines(){
      return DATA.lines.filter(l => lineSelect.map.get(l.id));
    }

    function countTempSelected(){
      let n = 0;
      DATA.lines.forEach(l => { if (lineTemp.map.get(l.id)) n++; });
      return n;
    }

    function makeLineChipForModal(line){
      const label = document.createElement("label");
      label.className = "chk";
      label.innerHTML = `
        <input type="checkbox" ${lineTemp.map.get(line.id) ? "checked":""} />
        <span class="sw" style="background:${line.color}"></span>
        <small>${line.name}</small>
      `;
      const input = label.querySelector("input");
      input.addEventListener("change", () => {
        lineTemp.map.set(line.id, input.checked);
        updateLineCountText();
      });
      return label;
    }

    function renderLineModalList(){
      const buckets = { metro: [], rail: [], lrt: [] };
      DATA.lines.forEach(l => buckets[l.group]?.push(l));

      for (const key of ["metro","rail","lrt"]) {
        const root = document.querySelector(`#group-${key}`);
        if(!root) continue;
        root.innerHTML = "";
        buckets[key].forEach(line => root.appendChild(makeLineChipForModal(line)));
      }
      updateLineCountText();
    }

    function updateLineCountText(){
      const n = countTempSelected();
      const el = document.querySelector("#lineCountText");
      if(el) el.textContent = `${n}개 선택됨`;
    }


    function setAllTemp(val){
      DATA.lines.forEach(l => lineTemp.map.set(l.id, val));
      renderLineModalList();
    }

    function setGroupTemp(group, val){
      DATA.lines.filter(l => l.group === group).forEach(l => lineTemp.map.set(l.id, val));
      renderLineModalList();
    }

    function openLineModal(){
      copySelectToTemp();
      renderLineModalList();
      const modal = document.querySelector("#lineModal");
      modal.classList.add("show");
      modal.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }

    function closeLineModal(){
      const modal = document.querySelector("#lineModal");
      modal.classList.remove("show");
      modal.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
    }

    document.querySelector("#openLineModal")?.addEventListener("click", openLineModal);
    document.querySelector("#closeLineModal")?.addEventListener("click", closeLineModal);
    document.querySelector("#lineModalBackdrop")?.addEventListener("click", closeLineModal);
    document.querySelector("#cancelLineModal")?.addEventListener("click", closeLineModal);

    document.querySelector("#applyLineModal")?.addEventListener("click", () => {
      const n = countTempSelected();
      if (n === 0) return toast("노선을 1개 이상 선택해줘");

      applyTempToSelect();
      closeLineModal();
      toast(`노선 ${n}개 적용됨`);
    });

    document.querySelector("#allOn")?.addEventListener("click", () => setAllTemp(true));
    document.querySelector("#allOff")?.addEventListener("click", () => setAllTemp(false));

    document.querySelectorAll("[data-group-on]").forEach(btn => {
      btn.addEventListener("click", () => setGroupTemp(btn.dataset.groupOn, true));
    });
    document.querySelectorAll("[data-group-off]").forEach(btn => {
      btn.addEventListener("click", () => setGroupTemp(btn.dataset.groupOff, false));
    });


    // ----- Utils -----
    const $ = (sel) => document.querySelector(sel);
    const rand = (arr) => arr[Math.floor(Math.random() * arr.length)];

    function toast(msg){
      const el = $("#toast");
      el.textContent = msg;
      el.classList.add("show");
      clearTimeout(toast._t);
      toast._t = setTimeout(() => el.classList.remove("show"), 1200);
    }

    function setStatus(text, tone="idle"){
      $("#statusText").textContent = text;
      const dot = $("#statusDot");
      if(tone === "ok") dot.style.background = "rgba(34,197,94,.75)";
      else if(tone === "warn") dot.style.background = "rgba(251,191,36,.75)";
      else dot.style.background = "rgba(148,163,184,.55)";
    }

    function setValue(el, html, final=false){
      el.classList.remove("animate","final");
      void el.offsetWidth;
      el.innerHTML = html;
      el.classList.add("animate");
      if(final) el.classList.add("final");
    }

    function lockStep(stepEl, locked){
      stepEl.classList.toggle("locked", locked);
    }

    // ----- Pretty glow -----
    const card = $("#card");
    card.addEventListener("pointermove", (e) => {
      const r = card.getBoundingClientRect();
      const x = ((e.clientX - r.left) / r.width) * 100;
      const y = ((e.clientY - r.top) / r.height) * 100;
      card.style.setProperty("--mx", x + "%");
      card.style.setProperty("--my", y + "%");
    });

    // ----- Slot Engine -----
    /**
     * SlotMachine:
     * - start(): spins indefinitely with current interval
     * - stop(): transitions into deceleration and settles on a final value
     */
    class SlotMachine {
      constructor({ getPool, renderTick, renderFinal, onFinal }) {
        this.getPool = getPool;               // () => array
        this.renderTick = renderTick;         // (value) => void
        this.renderFinal = renderFinal;       // (value) => void
        this.onFinal = onFinal;               // (value) => void

        this.state = "idle"; // idle | spinning | stopping
        this.timer = null;
        this.current = null;

        this.intervalMs = 60; // start speed
      }

      _clear() {
        if (this.timer) clearTimeout(this.timer);
        this.timer = null;
      }

      _tick() {
        const pool = this.getPool() || [];
        if (pool.length === 0) {
          this._clear();
          this.state = "idle";
          toast("후보군이 비어 있어요");
          return;
        }
        this.current = rand(pool);
        this.renderTick(this.current);

        // schedule next tick
        this.timer = setTimeout(() => this._tick(), this.intervalMs);
      }

      start() {
        if (this.state !== "idle") return;
        this.state = "spinning";
        this.intervalMs = 150;
        this._tick();
      }

      stop() {
        if (this.state !== "spinning") return;
        this.state = "stopping";
        this._clear();

        // deceleration plan:
        // gradually increase interval until it exceeds threshold, then settle.
        const targetSteps = 16;                // number of slowing ticks
        let step = 0;
        let interval = this.intervalMs;        // current
        const maxInterval = 700;               // slow end
        const growth = 1.25;                   // multiplier each step

        const decel = () => {
          const pool = this.getPool() || [];
          if (pool.length === 0) {
            this.state = "idle";
            toast("후보군이 비어 있어요");
            return;
          }
          this.current = rand(pool);
          this.renderTick(this.current);

          step += 1;
          interval = Math.min(maxInterval, Math.floor(interval * growth + 6));

          if (step >= targetSteps || interval >= maxInterval) {
            // final settle (one more tick, then finalize)
            const finalValue = rand(pool);
            this.current = finalValue;
            this.renderFinal(finalValue);
            this.state = "idle";
            this.onFinal?.(finalValue);
            return;
          }

          this.timer = setTimeout(decel, interval);
        };

        decel();
      }

      reset() {
        this._clear();
        this.state = "idle";
        this.current = null;
      }

      isIdle() { return this.state === "idle"; }
      isSpinning() { return this.state === "spinning"; }
      isStopping() { return this.state === "stopping"; }
    }

    // ----- App state -----
    const state = {
      line: null,
      station: null,
      food: null,
    };

    // ----- Elements -----
    const step2 = $("#step2");
    const step3 = $("#step3");

    const lineValue = $("#lineValue");
    const stationValue = $("#stationValue");
    const foodValue = $("#foodValue");

    const lineStart = $("#lineStart");
    const lineStop  = $("#lineStop");

    const stationStart = $("#stationStart");
    const stationStop  = $("#stationStop");

    const foodStart = $("#foodStart");
    const foodStop  = $("#foodStop");

    const resetAll = $("#resetAll");
    const copyResult = $("#copyResult");

    // ----- Render -----
    function renderLinePreview(lineObj) {
      if (!lineObj) {
        setValue(lineValue, `<span class="mini">시작을 눌러줘</span>`);
        return;
      }
      setValue(lineValue, `
        <span class="lineSwatch" style="background:${lineObj.color}"></span>
        <span>${lineObj.name}</span>
        <span class="mini">돌아가는 중…</span>
      `);
    }
    function renderLineFinal(lineObj) {
      setValue(lineValue, `
        <span class="lineSwatch" style="background:${lineObj.color}"></span>
        <span>${lineObj.name}</span>
        <span class="mini">확정</span>
      `, true);
    }

    function renderStationPreview(name) {
      if (!name) {
        const msg = state.line ? "시작을 눌러줘" : "노선을 먼저 확정해줘";
        setValue(stationValue, `<span class="mini">${msg}</span>`);
        return;
      }
      setValue(stationValue, `<span>${name}</span><span class="mini">돌아가는 중…</span>`);
    }
    function renderStationFinal(name) {
      setValue(stationValue, `<span>${name}</span><span class="mini">확정</span>`, true);
    }

    function renderFoodPreview(name) {
      if (!name) {
        const msg = state.station ? "시작을 눌러줘" : "역을 먼저 확정해줘";
        setValue(foodValue, `<span class="mini">${msg}</span>`);
        return;
      }
      setValue(foodValue, `<span>${name}</span><span class="mini">돌아가는 중…</span>`);
    }
    function renderFoodFinal(name) {
      setValue(foodValue, `<span>${name}</span><span class="mini">확정</span>`, true);
    }

    function syncLocks() {
      const hasLine = !!state.line;
      const hasStation = !!state.station;

      lockStep(step2, !hasLine);
      stationStart.disabled = !hasLine;
      stationStop.disabled = true;

      lockStep(step3, !hasStation);
      foodStart.disabled = !hasStation;
      foodStop.disabled = true;

      if (!hasLine) setStatus("대기 중", "idle");
      else if (hasLine && !hasStation) setStatus("노선 확정됨", "warn");
      else if (hasStation && !state.food) setStatus("역 확정됨", "warn");
      else if (state.food) setStatus("완료!", "ok");
    }

    function setButtonsFor(slot, startBtn, stopBtn) {
      // idle: start enabled, stop disabled
      // spinning: start disabled, stop enabled
      // stopping: both disabled
      if (slot.isIdle()) {
        startBtn.disabled = false;
        stopBtn.disabled = true;
      } else if (slot.isSpinning()) {
        startBtn.disabled = true;
        stopBtn.disabled = false;
      } else {
        startBtn.disabled = true;
        stopBtn.disabled = true;
      }
    }

    // ----- Slot instances -----
    const lineSlot = new SlotMachine({
      getPool: () => getSelectedLines(),
      renderTick: (lineObj) => renderLinePreview(lineObj),
      renderFinal: (lineObj) => renderLineFinal(lineObj),
      onFinal: (lineObj) => {
        state.line = lineObj;
        state.station = null;
        state.food = null;

        // reset dependent UI
        stationSlot.reset();
        foodSlot.reset();
        renderStationPreview(null);
        renderFoodPreview(null);

        syncLocks();
        celebrate(document.querySelector("#lineValue"));
        toast("노선 확정!");
      }
    });

    const stationSlot = new SlotMachine({
      getPool: () => {
        if (!state.line) return [];
        return DATA.stations[state.line.id] || [];
      },
      renderTick: (name) => renderStationPreview(name),
      renderFinal: (name) => renderStationFinal(name),
      onFinal: (name) => {
        state.station = name;
        state.food = null;

        foodSlot.reset();
        renderFoodPreview(null);

        syncLocks();
        celebrate(document.querySelector("#stationValue"));
        toast("역 확정!");
      }
    });

    const foodSlot = new SlotMachine({
      getPool: () => DATA.foods,
      renderTick: (name) => renderFoodPreview(name),
      renderFinal: (name) => renderFoodFinal(name),
      onFinal: (name) => {
        state.food = name;
        syncLocks();
        celebrate(document.querySelector("#foodValue"));
        toast("음식 확정!");
      }
    });

    // ----- Wiring (Start/Stop) -----
    lineStart.addEventListener("click", () => {
      // ensure others are not spinning
      if (!stationSlot.isIdle() || !foodSlot.isIdle()) return toast("다른 슬롯이 돌아가는 중이야");
      lineSlot.start();
      setButtonsFor(lineSlot, lineStart, lineStop);
      setStatus("노선 돌아가는 중", "warn");
    });
    lineStop.addEventListener("click", () => {
      lineSlot.stop();
      setButtonsFor(lineSlot, lineStart, lineStop);
      setStatus("노선 멈추는 중…", "warn");

      // poll until idle to update buttons
      const poll = () => {
        setButtonsFor(lineSlot, lineStart, lineStop);
        if (!lineSlot.isIdle()) requestAnimationFrame(poll);
        else setButtonsFor(lineSlot, lineStart, lineStop);
      };
      poll();
    });

    stationStart.addEventListener("click", () => {
      if (!state.line) return toast("노선을 먼저 확정해줘");
      if (!lineSlot.isIdle() || !foodSlot.isIdle()) return toast("다른 슬롯이 돌아가는 중이야");
      stationSlot.start();
      setButtonsFor(stationSlot, stationStart, stationStop);
      setStatus("역 돌아가는 중", "warn");
    });
    stationStop.addEventListener("click", () => {
      stationSlot.stop();
      setButtonsFor(stationSlot, stationStart, stationStop);
      setStatus("역 멈추는 중…", "warn");

      const poll = () => {
        setButtonsFor(stationSlot, stationStart, stationStop);
        if (!stationSlot.isIdle()) requestAnimationFrame(poll);
        else setButtonsFor(stationSlot, stationStart, stationStop);
      };
      poll();
    });

    foodStart.addEventListener("click", () => {
      if (!state.station) return toast("역을 먼저 확정해줘");
      if (!lineSlot.isIdle() || !stationSlot.isIdle()) return toast("다른 슬롯이 돌아가는 중이야");
      foodSlot.start();
      setButtonsFor(foodSlot, foodStart, foodStop);
      setStatus("음식 돌아가는 중", "warn");
    });
    foodStop.addEventListener("click", () => {
      foodSlot.stop();
      setButtonsFor(foodSlot, foodStart, foodStop);
      setStatus("음식 멈추는 중…", "warn");

      const poll = () => {
        setButtonsFor(foodSlot, foodStart, foodStop);
        if (!foodSlot.isIdle()) requestAnimationFrame(poll);
        else setButtonsFor(foodSlot, foodStart, foodStop);
      };
      poll();
    });

    // ----- Copy / Reset -----
    function copyText(txt){
      if (!txt) return;
      if (navigator.clipboard?.writeText) {
        navigator.clipboard.writeText(txt).then(() => toast("복사됨"));
      } else {
        const ta = document.createElement("textarea");
        ta.value = txt;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        toast("복사됨");
      }
    }
    function buildResultText(){
      const parts = [];
      if (state.line) parts.push(state.line.name);
      if (state.station) parts.push(state.station + "역");
      if (state.food) parts.push(state.food);
      if (parts.length === 0) return "아직 뽑은 결과가 없어";
      return "오늘의 랜덤: " + parts.join(" / ");
    }

    resetAll.addEventListener("click", () => {
      lineSlot.reset();
      stationSlot.reset();
      foodSlot.reset();
      state.line = null;
      state.station = null;
      state.food = null;

      setValue(lineValue, `<span class="mini">시작을 눌러줘</span>`);
      renderStationPreview(null);
      renderFoodPreview(null);

      lockStep(step2, true);
      lockStep(step3, true);

      lineStart.disabled = false;
      lineStop.disabled = true;
      stationStart.disabled = true;
      stationStop.disabled = true;
      foodStart.disabled = true;
      foodStop.disabled = true;

      setStatus("대기 중", "idle");
      toast("초기화 완료");
    });

    copyResult.addEventListener("click", () => copyText(buildResultText()));

    // Initial state
    setStatus("대기 중", "idle");
    lockStep(step2, true);
    lockStep(step3, true);
  </script>
</body>
</html>
